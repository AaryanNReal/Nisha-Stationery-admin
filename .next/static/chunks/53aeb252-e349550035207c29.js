"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[537],{4029:function(e,t,n){let r,i,o;var s=n(1876).Buffer;function l(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function f(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function u(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function a(e){return"[object Map]"===Object.prototype.toString.call(e)}function h(e){return"[object Date]"===Object.prototype.toString.call(e)}function g(e,t){return JSON.stringify(e,(e,t)=>"bigint"==typeof t?{$numberLong:`${t}`}:a(t)?Object.fromEntries(t):t)}let c=0x7fffffffffffffff-1,b=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127});class d extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(e,t){super(e,t)}static isBSONError(e){return null!=e&&"object"==typeof e&&"bsonError"in e&&!0===e.bsonError&&"name"in e&&"message"in e&&"stack"in e}}class m extends d{get name(){return"BSONVersionError"}constructor(){super("Unsupported BSON version, bson types must be from bson 6.x.x")}}class p extends d{get name(){return"BSONRuntimeError"}constructor(e){super(e)}}class y extends d{get name(){return"BSONOffsetError"}constructor(e,t,n){super(`${e}. offset: ${t}`,n),this.offset=t}}function w(e,t,n,o){if(o){r??=new TextDecoder("utf8",{fatal:!0});try{return r.decode(e.subarray(t,n))}catch(e){throw new d("Invalid UTF-8 string in BSON document",{cause:e})}}return(i??=new TextDecoder("utf8",{fatal:!1})).decode(e.subarray(t,n))}function S(e,t,n){if(0===e.length)return"";let r=n-t;if(0===r)return"";if(r>20)return null;if(1===r&&e[t]<128)return String.fromCharCode(e[t]);if(2===r&&e[t]<128&&e[t+1]<128)return String.fromCharCode(e[t])+String.fromCharCode(e[t+1]);if(3===r&&e[t]<128&&e[t+1]<128&&e[t+2]<128)return String.fromCharCode(e[t])+String.fromCharCode(e[t+1])+String.fromCharCode(e[t+2]);let i=[];for(let r=t;r<n;r++){let t=e[r];if(t>127)return null;i.push(t)}return String.fromCharCode(...i)}function B(e){return N.fromNumberArray(Array.from({length:e},()=>Math.floor(256*Math.random())))}let N={toLocalBufferType(e){if(s.isBuffer(e))return e;if(ArrayBuffer.isView(e))return s.from(e.buffer,e.byteOffset,e.byteLength);let t=e?.[Symbol.toStringTag]??Object.prototype.toString.call(e);if("ArrayBuffer"===t||"SharedArrayBuffer"===t||"[object ArrayBuffer]"===t||"[object SharedArrayBuffer]"===t)return s.from(e);throw new d(`Cannot create Buffer from ${String(e)}`)},allocate:e=>s.alloc(e),allocateUnsafe:e=>s.allocUnsafe(e),equals:(e,t)=>N.toLocalBufferType(e).equals(t),fromNumberArray:e=>s.from(e),fromBase64:e=>s.from(e,"base64"),toBase64:e=>N.toLocalBufferType(e).toString("base64"),fromISO88591:e=>s.from(e,"binary"),toISO88591:e=>N.toLocalBufferType(e).toString("binary"),fromHex:e=>s.from(e,"hex"),toHex:e=>N.toLocalBufferType(e).toString("hex"),toUTF8(e,t,n,r){let i=n-t<=20?S(e,t,n):null;if(null!=i)return i;let o=N.toLocalBufferType(e).toString("utf8",t,n);if(r){for(let r=0;r<o.length;r++)if(65533===o.charCodeAt(r)){w(e,t,n,!0);break}}return o},utf8ByteLength:e=>s.byteLength(e,"utf8"),encodeUTF8Into(e,t,n){let r=function(e,t,n){if(0===t.length)return 0;if(t.length>25||e.length-n<t.length)return null;for(let r=0,i=n;r<t.length;r++,i++){let n=t.charCodeAt(r);if(n>127)return null;e[i]=n}return t.length}(e,t,n);return null!=r?r:N.toLocalBufferType(e).write(t,n,void 0,"utf8")},randomBytes:(()=>{try{return n(2474).randomBytes}catch{return B}})()};function E(e){if(e<0)throw RangeError(`The argument 'byteLength' is invalid. Received ${e}`);return $.fromNumberArray(Array.from({length:e},()=>Math.floor(256*Math.random())))}let O=(()=>{let{crypto:e}=globalThis;if(null!=e&&"function"==typeof e.getRandomValues)return t=>e.getRandomValues($.allocate(t));if(function(){let{navigator:e}=globalThis;return"object"==typeof e&&"ReactNative"===e.product}()){let{console:e}=globalThis;e?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return E})(),x=/(\d|[a-f])/i,$={toLocalBufferType(e){let t=e?.[Symbol.toStringTag]??Object.prototype.toString.call(e);if("Uint8Array"===t)return e;if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));if("ArrayBuffer"===t||"SharedArrayBuffer"===t||"[object ArrayBuffer]"===t||"[object SharedArrayBuffer]"===t)return new Uint8Array(e);throw new d(`Cannot make a Uint8Array from ${String(e)}`)},allocate(e){if("number"!=typeof e)throw TypeError(`The "size" argument must be of type number. Received ${String(e)}`);return new Uint8Array(e)},allocateUnsafe:e=>$.allocate(e),equals(e,t){if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0},fromNumberArray:e=>Uint8Array.from(e),fromBase64:e=>Uint8Array.from(atob(e),e=>e.charCodeAt(0)),toBase64:e=>btoa($.toISO88591(e)),fromISO88591:e=>Uint8Array.from(e,e=>255&e.charCodeAt(0)),toISO88591:e=>Array.from(Uint16Array.from(e),e=>String.fromCharCode(e)).join(""),fromHex(e){let t=e.length%2==0?e:e.slice(0,e.length-1),n=[];for(let e=0;e<t.length;e+=2){let r=t[e],i=t[e+1];if(!x.test(r)||!x.test(i))break;let o=Number.parseInt(`${r}${i}`,16);n.push(o)}return Uint8Array.from(n)},toHex:e=>Array.from(e,e=>e.toString(16).padStart(2,"0")).join(""),toUTF8(e,t,n,r){let i=n-t<=20?S(e,t,n):null;return null!=i?i:w(e,t,n,r)},utf8ByteLength:e=>new TextEncoder().encode(e).byteLength,encodeUTF8Into(e,t,n){let r=new TextEncoder().encode(t);return e.set(r,n),r.byteLength},randomBytes:O},I="function"==typeof s&&s.prototype?._isBuffer!==!0?N:$;class _{get[Symbol.for("@@mdb.bson.version")](){return 6}[Symbol.for("nodejs.util.inspect.custom")](e,t,n){return this.inspect(e,t,n)}}class L extends _{get _bsontype(){return"Binary"}constructor(e,t){if(super(),null!=e&&"string"==typeof e&&!ArrayBuffer.isView(e)&&!l(e)&&!Array.isArray(e))throw new d("Binary can only be constructed from Uint8Array or number[]");this.sub_type=t??L.BSON_BINARY_SUBTYPE_DEFAULT,null==e?(this.buffer=I.allocate(L.BUFFER_SIZE),this.position=0):(this.buffer=Array.isArray(e)?I.fromNumberArray(e):I.toLocalBufferType(e),this.position=this.buffer.byteLength)}put(e){let t;if("string"==typeof e&&1!==e.length)throw new d("only accepts single character String");if("number"!=typeof e&&1!==e.length)throw new d("only accepts single character Uint8Array or Array");if((t="string"==typeof e?e.charCodeAt(0):"number"==typeof e?e:e[0])<0||t>255)throw new d("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=t;else{let e=I.allocate(L.BUFFER_SIZE+this.buffer.length);e.set(this.buffer,0),this.buffer=e,this.buffer[this.position++]=t}}write(e,t){if(t="number"==typeof t?t:this.position,this.buffer.byteLength<t+e.length){let t=I.allocate(this.buffer.byteLength+e.length);t.set(this.buffer,0),this.buffer=t}if(ArrayBuffer.isView(e))this.buffer.set(I.toLocalBufferType(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position;else if("string"==typeof e)throw new d("input cannot be string")}read(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)}value(){return this.buffer.length===this.position?this.buffer:this.buffer.subarray(0,this.position)}length(){return this.position}toJSON(){return I.toBase64(this.buffer.subarray(0,this.position))}toString(e){return"hex"===e?I.toHex(this.buffer.subarray(0,this.position)):"base64"===e?I.toBase64(this.buffer.subarray(0,this.position)):I.toUTF8(this.buffer,0,this.position,!1)}toExtendedJSON(e){e=e||{};let t=I.toBase64(this.buffer),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===n.length?"0"+n:n}:{$binary:{base64:t,subType:1===n.length?"0"+n:n}}}toUUID(){if(this.sub_type===L.SUBTYPE_UUID)return new v(this.buffer.slice(0,this.position));throw new d(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${L.SUBTYPE_UUID}" is currently supported.`)}static createFromHexString(e,t){return new L(I.fromHex(e),t)}static createFromBase64(e,t){return new L(I.fromBase64(e),t)}static fromExtendedJSON(e,t){let n,r;if(t=t||{},"$binary"in e?t.legacy&&"string"==typeof e.$binary&&"$type"in e?(r=e.$type?parseInt(e.$type,16):0,n=I.fromBase64(e.$binary)):"string"!=typeof e.$binary&&(r=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=I.fromBase64(e.$binary.base64)):"$uuid"in e&&(r=4,n=v.bytesFromString(e.$uuid)),!n)throw new d(`Unexpected Binary Extended JSON format ${JSON.stringify(e)}`);return 4===r?new v(n):new L(n,r)}inspect(e,t,n){n??=g;let r=I.toBase64(this.buffer.subarray(0,this.position)),i=n(r,t),o=n(this.sub_type,t);return`Binary.createFromBase64(${i}, ${o})`}}L.BSON_BINARY_SUBTYPE_DEFAULT=0,L.BUFFER_SIZE=256,L.SUBTYPE_DEFAULT=0,L.SUBTYPE_FUNCTION=1,L.SUBTYPE_BYTE_ARRAY=2,L.SUBTYPE_UUID_OLD=3,L.SUBTYPE_UUID=4,L.SUBTYPE_MD5=5,L.SUBTYPE_ENCRYPTED=6,L.SUBTYPE_COLUMN=7,L.SUBTYPE_SENSITIVE=8,L.SUBTYPE_USER_DEFINED=128;let U=/^[0-9A-F]{32}$/i,T=/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i;class v extends L{constructor(e){let t;if(null==e)t=v.generate();else if(e instanceof v)t=I.toLocalBufferType(new Uint8Array(e.buffer));else if(ArrayBuffer.isView(e)&&16===e.byteLength)t=I.toLocalBufferType(e);else if("string"==typeof e)t=v.bytesFromString(e);else throw new d("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");super(t,4)}get id(){return this.buffer}set id(e){this.buffer=e}toHexString(e=!0){return e?[I.toHex(this.buffer.subarray(0,4)),I.toHex(this.buffer.subarray(4,6)),I.toHex(this.buffer.subarray(6,8)),I.toHex(this.buffer.subarray(8,10)),I.toHex(this.buffer.subarray(10,16))].join("-"):I.toHex(this.buffer)}toString(e){return"hex"===e?I.toHex(this.id):"base64"===e?I.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(e){if(!e)return!1;if(e instanceof v)return I.equals(e.id,this.id);try{return I.equals(new v(e).id,this.id)}catch{return!1}}toBinary(){return new L(this.id,L.SUBTYPE_UUID)}static generate(){let e=I.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e}static isValid(e){return!!e&&("string"==typeof e?v.isValidUUIDString(e):f(e)?16===e.byteLength:"Binary"===e._bsontype&&e.sub_type===this.SUBTYPE_UUID&&16===e.buffer.byteLength)}static createFromHexString(e){let t=v.bytesFromString(e);return new v(t)}static createFromBase64(e){return new v(I.fromBase64(e))}static bytesFromString(e){if(!v.isValidUUIDString(e))throw new d("UUID string representation must be 32 hex digits or canonical hyphenated representation");return I.fromHex(e.replace(/-/g,""))}static isValidUUIDString(e){return U.test(e)||T.test(e)}inspect(e,t,n){return n??=g,`new UUID(${n(this.toHexString(),t)})`}}class j extends _{get _bsontype(){return"Code"}constructor(e,t){super(),this.code=e.toString(),this.scope=t??null}toJSON(){return null!=this.scope?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(e){return new j(e.$code,e.$scope)}inspect(e,t,n){let r=(n??=g)(this.code,t),i=r.includes("\n");null!=this.scope&&(r+=`,${i?"\n":" "}${n(this.scope,t)}`);let o=i&&null===this.scope;return`new Code(${i?"\n":""}${r}${o?"\n":""})`}}function A(e){return null!=e&&"object"==typeof e&&"$id"in e&&null!=e.$id&&"$ref"in e&&"string"==typeof e.$ref&&(!("$db"in e)||"$db"in e&&"string"==typeof e.$db)}class R extends _{get _bsontype(){return"DBRef"}constructor(e,t,n,r){super();let i=e.split(".");2===i.length&&(n=i.shift(),e=i.shift()),this.collection=e,this.oid=t,this.db=n,this.fields=r||{}}get namespace(){return this.collection}set namespace(e){this.collection=e}toJSON(){let e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e}toExtendedJSON(e){e=e||{};let t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))}static fromExtendedJSON(e){let t=Object.assign({},e);return delete t.$ref,delete t.$id,delete t.$db,new R(e.$ref,e.$id,e.$db,t)}inspect(e,t,n){let r=[(n??=g)(this.namespace,t),n(this.oid,t),...this.db?[n(this.db,t)]:[],...Object.keys(this.fields).length>0?[n(this.fields,t)]:[]];return r[1]=n===g?`new ObjectId(${r[1]})`:r[1],`new DBRef(${r.join(", ")})`}}function D(e){if(""===e)return e;let t=0,n="-"===e[0],r="+"===e[t];(r||n)&&(t+=1);let i=!1;for(;t<e.length&&"0"===e[t];++t)i=!0;return i?`${n?"-":""}${e.length===t?"0":e.slice(t)}`:r?e.slice(1):e}try{o=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}let F={},z={},M=/^(\+?0|(\+|-)?[1-9][0-9]*)$/;class J extends _{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(e=0,t,n){super();let r="boolean"==typeof t?t:!!n,i="string"==typeof e?J.fromString(e,r):"bigint"==typeof e?J.fromBigInt(e,r):{low:0|e,high:0|("number"==typeof t?t:0),unsigned:r};this.low=i.low,this.high=i.high,this.unsigned=i.unsigned}static fromBits(e,t,n){return new J(e,t,n)}static fromInt(e,t){let n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=z[e]))?r:(n=J.fromBits(e,(0|e)<0?-1:0,!0),i&&(z[e]=n),n):(e|=0,(i=-128<=e&&e<128)&&(r=F[e]))?r:(n=J.fromBits(e,e<0?-1:0,!1),i&&(F[e]=n),n)}static fromNumber(e,t){if(isNaN(e))return t?J.UZERO:J.ZERO;if(t){if(e<0)return J.UZERO;if(e>=18446744073709552e3)return J.MAX_UNSIGNED_VALUE}else{if(e<=-0x8000000000000000)return J.MIN_VALUE;if(e+1>=0x7fffffffffffffff)return J.MAX_VALUE}return e<0?J.fromNumber(-e,t).neg():J.fromBits(e%4294967296|0,e/4294967296|0,t)}static fromBigInt(e,t){let n=BigInt(4294967295),r=BigInt(32);return new J(Number(e&n),Number(e>>r&n),t)}static _fromString(e,t,n){let r;if(0===e.length)throw new d("empty string");if(n<2||36<n)throw new d("radix");if((r=e.indexOf("-"))>0)throw new d("interior hyphen");if(0===r)return J._fromString(e.substring(1),t,n).neg();let i=J.fromNumber(Math.pow(n,8)),o=J.ZERO;for(let t=0;t<e.length;t+=8){let r=Math.min(8,e.length-t),s=parseInt(e.substring(t,t+r),n);if(r<8){let e=J.fromNumber(Math.pow(n,r));o=o.mul(e).add(J.fromNumber(s))}else o=(o=o.mul(i)).add(J.fromNumber(s))}return o.unsigned=t,o}static fromStringStrict(e,t,n){let r=!1;if("number"==typeof t?(n=t,t=!1):r=!!t,n??=10,e.trim()!==e)throw new d(`Input: '${e}' contains leading and/or trailing whitespace`);if(!function(e,t){t=t??10;let n="0123456789abcdefghijklmnopqrstuvwxyz".slice(0,t);return!RegExp(`[^-+${n}]`,"i").test(e)&&e}(e,n))throw new d(`Input: '${e}' contains invalid characters for radix: ${n}`);let i=D(e),o=J._fromString(i,r,n);if(o.toString(n).toLowerCase()!==i.toLowerCase())throw new d(`Input: ${e} is not representable as ${o.unsigned?"an unsigned":"a signed"} 64-bit Long ${null!=n?`with radix: ${n}`:""}`);return o}static fromString(e,t,n){let r=!1;return("number"==typeof t?(n=t,t=!1):r=!!t,n??=10,"NaN"===e&&n<24)?J.ZERO:("Infinity"===e||"+Infinity"===e||"-Infinity"===e)&&n<35?J.ZERO:J._fromString(e,r,n)}static fromBytes(e,t,n){return n?J.fromBytesLE(e,t):J.fromBytesBE(e,t)}static fromBytesLE(e,t){return new J(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)}static fromBytesBE(e,t){return new J(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}static isLong(e){return null!=e&&"object"==typeof e&&"__isLong__"in e&&!0===e.__isLong__}static fromValue(e,t){return"number"==typeof e?J.fromNumber(e,t):"string"==typeof e?J.fromString(e,t):J.fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}add(e){J.isLong(e)||(e=J.fromValue(e));let t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,l=e.low>>>16,f=65535&e.low,u=0,a=0,h,g;return h=0+((g=0+(i+f))>>>16),g&=65535,h+=r+l,a+=h>>>16,h&=65535,a+=n+s,u+=a>>>16,a&=65535,u+=t+o,u&=65535,J.fromBits(h<<16|g,u<<16|a,this.unsigned)}and(e){return J.isLong(e)||(e=J.fromValue(e)),J.fromBits(this.low&e.low,this.high&e.high,this.unsigned)}compare(e){if(J.isLong(e)||(e=J.fromValue(e)),this.eq(e))return 0;let t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1}comp(e){return this.compare(e)}divide(e){let t,n,r;if(J.isLong(e)||(e=J.fromValue(e)),e.isZero())throw new d("division by zero");if(o){if(!this.unsigned&&-2147483648===this.high&&-1===e.low&&-1===e.high)return this;let t=(this.unsigned?o.div_u:o.div_s)(this.low,this.high,e.low,e.high);return J.fromBits(t,o.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?J.UZERO:J.ZERO;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return J.UZERO;if(e.gt(this.shru(1)))return J.UONE;r=J.UZERO}else{if(this.eq(J.MIN_VALUE))return e.eq(J.ONE)||e.eq(J.NEG_ONE)?J.MIN_VALUE:e.eq(J.MIN_VALUE)?J.ONE:(t=this.shr(1).div(e).shl(1)).eq(J.ZERO)?e.isNegative()?J.ONE:J.NEG_ONE:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(J.MIN_VALUE))return this.unsigned?J.UZERO:J.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=J.ZERO}for(n=this;n.gte(e);){let i=Math.ceil(Math.log(t=Math.max(1,Math.floor(n.toNumber()/e.toNumber())))/Math.LN2),o=i<=48?1:Math.pow(2,i-48),s=J.fromNumber(t),l=s.mul(e);for(;l.isNegative()||l.gt(n);)t-=o,l=(s=J.fromNumber(t,this.unsigned)).mul(e);s.isZero()&&(s=J.ONE),r=r.add(s),n=n.sub(l)}return r}div(e){return this.divide(e)}equals(e){return J.isLong(e)||(e=J.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}eq(e){return this.equals(e)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){let e;if(this.isNegative())return this.eq(J.MIN_VALUE)?64:this.neg().getNumBitsAbs();let t=0!==this.high?this.high:this.low;for(e=31;e>0&&(t&1<<e)==0;e--);return 0!==this.high?e+33:e+1}greaterThan(e){return this.comp(e)>0}gt(e){return this.greaterThan(e)}greaterThanOrEqual(e){return this.comp(e)>=0}gte(e){return this.greaterThanOrEqual(e)}ge(e){return this.greaterThanOrEqual(e)}isEven(){return(1&this.low)==0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(1&this.low)==1}isPositive(){return this.unsigned||this.high>=0}isZero(){return 0===this.high&&0===this.low}lessThan(e){return 0>this.comp(e)}lt(e){return this.lessThan(e)}lessThanOrEqual(e){return 0>=this.comp(e)}lte(e){return this.lessThanOrEqual(e)}modulo(e){if(J.isLong(e)||(e=J.fromValue(e)),o){let t=(this.unsigned?o.rem_u:o.rem_s)(this.low,this.high,e.low,e.high);return J.fromBits(t,o.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))}mod(e){return this.modulo(e)}rem(e){return this.modulo(e)}multiply(e){if(this.isZero())return J.ZERO;if(J.isLong(e)||(e=J.fromValue(e)),o){let t=o.mul(this.low,this.high,e.low,e.high);return J.fromBits(t,o.get_high(),this.unsigned)}if(e.isZero())return J.ZERO;if(this.eq(J.MIN_VALUE))return e.isOdd()?J.MIN_VALUE:J.ZERO;if(e.eq(J.MIN_VALUE))return this.isOdd()?J.MIN_VALUE:J.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(J.TWO_PWR_24)&&e.lt(J.TWO_PWR_24))return J.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);let t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,s=e.high>>>16,l=65535&e.high,f=e.low>>>16,u=65535&e.low,a=0,h=0,g,c;return g=0+((c=0+i*u)>>>16),c&=65535,g+=r*u,h+=g>>>16,g&=65535,g+=i*f,h+=g>>>16,g&=65535,h+=n*u,a+=h>>>16,h&=65535,h+=r*f,a+=h>>>16,h&=65535,h+=i*l,a+=h>>>16,h&=65535,a+=t*u+n*f+r*l+i*s,a&=65535,J.fromBits(g<<16|c,a<<16|h,this.unsigned)}mul(e){return this.multiply(e)}negate(){return!this.unsigned&&this.eq(J.MIN_VALUE)?J.MIN_VALUE:this.not().add(J.ONE)}neg(){return this.negate()}not(){return J.fromBits(~this.low,~this.high,this.unsigned)}notEquals(e){return!this.equals(e)}neq(e){return this.notEquals(e)}ne(e){return this.notEquals(e)}or(e){return J.isLong(e)||(e=J.fromValue(e)),J.fromBits(this.low|e.low,this.high|e.high,this.unsigned)}shiftLeft(e){return(J.isLong(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?J.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):J.fromBits(0,this.low<<e-32,this.unsigned)}shl(e){return this.shiftLeft(e)}shiftRight(e){return(J.isLong(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?J.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):J.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)}shr(e){return this.shiftRight(e)}shiftRightUnsigned(e){if(J.isLong(e)&&(e=e.toInt()),0==(e&=63))return this;{let t=this.high;if(e<32){let n=this.low;return J.fromBits(n>>>e|t<<32-e,t>>>e,this.unsigned)}return 32===e?J.fromBits(t,0,this.unsigned):J.fromBits(t>>>e-32,0,this.unsigned)}}shr_u(e){return this.shiftRightUnsigned(e)}shru(e){return this.shiftRightUnsigned(e)}subtract(e){return J.isLong(e)||(e=J.fromValue(e)),this.add(e.neg())}sub(e){return this.subtract(e)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*4294967296+(this.low>>>0):4294967296*this.high+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(e){return e?this.toBytesLE():this.toBytesBE()}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}toBytesBE(){let e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]}toSigned(){return this.unsigned?J.fromBits(this.low,this.high,!1):this}toString(e){if((e=e||10)<2||36<e)throw new d("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(J.MIN_VALUE))return"-"+this.neg().toString(e);{let t=J.fromNumber(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}}let t=J.fromNumber(Math.pow(e,6),this.unsigned),n=this,r="";for(;;){let i=n.div(t),o=(n.sub(i.mul(t)).toInt()>>>0).toString(e);if((n=i).isZero())return o+r;for(;o.length<6;)o="0"+o;r=""+o+r}}toUnsigned(){return this.unsigned?this:J.fromBits(this.low,this.high,!0)}xor(e){return J.isLong(e)||(e=J.fromValue(e)),J.fromBits(this.low^e.low,this.high^e.high,this.unsigned)}eqz(){return this.isZero()}le(e){return this.lessThanOrEqual(e)}toExtendedJSON(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(e,t){let{useBigInt64:n=!1,relaxed:r=!0}={...t};if(e.$numberLong.length>20)throw new d("$numberLong string is too long");if(!M.test(e.$numberLong))throw new d(`$numberLong string "${e.$numberLong}" is in an invalid format`);if(n)return BigInt.asIntN(64,BigInt(e.$numberLong));let i=J.fromString(e.$numberLong);return r?i.toNumber():i}inspect(e,t,n){let r=(n??=g)(this.toString(),t),i=this.unsigned?`, ${n(this.unsigned,t)}`:"";return`new Long(${r}${i})`}}J.TWO_PWR_24=J.fromInt(16777216),J.MAX_UNSIGNED_VALUE=J.fromBits(-1,-1,!0),J.ZERO=J.fromInt(0),J.UZERO=J.fromInt(0,!0),J.ONE=J.fromInt(1),J.UONE=J.fromInt(1,!0),J.NEG_ONE=J.fromInt(-1),J.MAX_VALUE=J.fromBits(-1,2147483647,!1),J.MIN_VALUE=J.fromBits(0,-2147483648,!1);let V=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,C=/^(\+|-)?(Infinity|inf)$/i,H=/^(\+|-)?NaN$/i,k=I.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),q=I.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Y=I.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Z=/^([-+])?(\d+)?$/;function P(e){return!isNaN(parseInt(e,10))}function K(e,t){throw new d(`"${e}" is not a valid Decimal128 string - ${t}`)}class W extends _{get _bsontype(){return"Decimal128"}constructor(e){if(super(),"string"==typeof e)this.bytes=W.fromString(e).bytes;else if(f(e)){if(16!==e.byteLength)throw new d("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}else throw new d("Decimal128 must take a Buffer or string")}static fromString(e){return W._fromString(e,{allowRounding:!1})}static fromStringWithRounding(e){return W._fromString(e,{allowRounding:!0})}static _fromString(e,t){let n=!1,r=!1,i=!1,o=!1,s=0,l=0,f=0,u=0,a=0,h=[0],g=0,c=0,b=0,m=0,p=new J(0,0),y=new J(0,0),w=0,S=0;if(e.length>=7e3)throw new d(""+e+" not a valid Decimal128 string");let B=e.match(V),N=e.match(C),E=e.match(H);if(!B&&!N&&!E||0===e.length)throw new d(""+e+" not a valid Decimal128 string");if(B){let t=B[2],n=B[4],r=B[5],i=B[6];n&&void 0===i&&K(e,"missing exponent power"),n&&void 0===t&&K(e,"missing exponent base"),void 0===n&&(r||i)&&K(e,"missing e before exponent")}if(("+"===e[S]||"-"===e[S])&&(r=!0,n="-"===e[S++]),!P(e[S])&&"."!==e[S]){if("i"===e[S]||"I"===e[S])return new W(n?q:Y);if("N"===e[S])return new W(k)}for(;P(e[S])||"."===e[S];){if("."===e[S]){i&&K(e,"contains multiple periods"),i=!0,S+=1;continue}g<34&&("0"!==e[S]||o)&&(o||(a=l),o=!0,h[c++]=parseInt(e[S],10),g+=1),o&&(f+=1),i&&(u+=1),l+=1,S+=1}if(i&&!l)throw new d(""+e+" not a valid Decimal128 string");if("e"===e[S]||"E"===e[S]){let t=e.substr(++S).match(Z);if(!t||!t[2])return new W(k);m=parseInt(t[0],10),S+=t[0].length}if(e[S])return new W(k);if(g){if(b=g-1,1!==(s=f))for(;"0"===e[a+s-1+Number(r)+Number(i)];)s-=1}else h[0]=0,f=1,g=1,s=0;for(m<=u&&u>m+16384?m=-6176:m-=u;m>6111;){if((b+=1)>=34){if(0===s){m=6111;break}K(e,"overflow")}m-=1}if(t.allowRounding){for(;m<-6176||g<f;){if(0===b&&s<g){m=-6176,s=0;break}if(g<f?f-=1:b-=1,m<6111)m+=1;else{if(h.join("").match(/^0+$/)){m=6111;break}K(e,"overflow")}}if(b+1<s){let t=l;i&&(a+=1,t+=1),r&&(a+=1,t+=1);let o=parseInt(e[a+b+1],10),s=0;if(o>=5&&(s=1,5===o)){s=h[b]%2==1?1:0;for(let n=a+b+2;n<t;n++)if(parseInt(e[n],10)){s=1;break}}if(s){let e=b;for(;e>=0;e--)if(++h[e]>9){if(h[e]=0,0===e){if(!(m<6111))return new W(n?q:Y);m+=1,h[e]=1}}else break}}}else{for(;m<-6176||g<f;){if(0===b){if(0===s){m=-6176;break}K(e,"exponent underflow")}g<f?("0"!==e[f-1+Number(r)+Number(i)]&&0!==s&&K(e,"inexact rounding"),f-=1):(0!==h[b]&&K(e,"inexact rounding"),b-=1),m<6111?m+=1:K(e,"overflow")}b+1<s&&(i&&(a+=1),r&&(a+=1),0!==parseInt(e[a+b+1],10)&&K(e,"inexact rounding"))}if(p=J.fromNumber(0),y=J.fromNumber(0),0===s)p=J.fromNumber(0),y=J.fromNumber(0);else if(b<17){let e=0;for(y=J.fromNumber(h[e++]),p=new J(0,0);e<=b;e++)y=(y=y.multiply(J.fromNumber(10))).add(J.fromNumber(h[e]))}else{let e=0;for(p=J.fromNumber(h[e++]);e<=b-17;e++)p=(p=p.multiply(J.fromNumber(10))).add(J.fromNumber(h[e]));for(y=J.fromNumber(h[e++]);e<=b;e++)y=(y=y.multiply(J.fromNumber(10))).add(J.fromNumber(h[e]))}let O=function(e,t){if(!e&&!t)return{high:J.fromNumber(0),low:J.fromNumber(0)};let n=e.shiftRightUnsigned(32),r=new J(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new J(t.getLowBits(),0),s=n.multiply(i),l=n.multiply(o),f=r.multiply(i),u=r.multiply(o);return s=s.add(l.shiftRightUnsigned(32)),l=new J(l.getLowBits(),0).add(f).add(u.shiftRightUnsigned(32)),{high:s=s.add(l.shiftRightUnsigned(32)),low:u=l.shiftLeft(32).add(new J(u.getLowBits(),0))}}(p,J.fromString("100000000000000000"));O.low=O.low.add(y),function(e,t){let n=e.high>>>0,r=t.high>>>0;return!!(n<r)||n===r&&!!(e.low>>>0<t.low>>>0)}(O.low,y)&&(O.high=O.high.add(J.fromNumber(1))),w=m+6176;let x={low:J.fromNumber(0),high:J.fromNumber(0)};O.high.shiftRightUnsigned(49).and(J.fromNumber(1)).equals(J.fromNumber(1))?(x.high=x.high.or(J.fromNumber(3).shiftLeft(61)),x.high=x.high.or(J.fromNumber(w).and(J.fromNumber(16383).shiftLeft(47))),x.high=x.high.or(O.high.and(J.fromNumber(0x7fffffffffff)))):(x.high=x.high.or(J.fromNumber(16383&w).shiftLeft(49)),x.high=x.high.or(O.high.and(J.fromNumber(562949953421311)))),x.low=O.low,n&&(x.high=x.high.or(J.fromString("9223372036854775808")));let $=I.allocateUnsafe(16);return S=0,$[S++]=255&x.low.low,$[S++]=x.low.low>>8&255,$[S++]=x.low.low>>16&255,$[S++]=x.low.low>>24&255,$[S++]=255&x.low.high,$[S++]=x.low.high>>8&255,$[S++]=x.low.high>>16&255,$[S++]=x.low.high>>24&255,$[S++]=255&x.high.low,$[S++]=x.high.low>>8&255,$[S++]=x.high.low>>16&255,$[S++]=x.high.low>>24&255,$[S++]=255&x.high.high,$[S++]=x.high.high>>8&255,$[S++]=x.high.high>>16&255,$[S++]=x.high.high>>24&255,new W($)}toString(){let e,t,n,r;let i=0,o=Array(36);for(let e=0;e<o.length;e++)o[e]=0;let s=0,l=!1,f={parts:[0,0,0,0]},u=[];s=0;let a=this.bytes,h=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24,g=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24,c=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24,b=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24;s=0,({low:new J(h,g),high:new J(c,b)}).high.lessThan(J.ZERO)&&u.push("-");let d=b>>26&31;if(d>>3==3){if(30===d)return u.join("")+"Infinity";if(31===d)return"NaN";e=b>>15&16383,t=8+(b>>14&1)}else t=b>>14&7,e=b>>17&16383;let m=e-6176;if(f.parts[0]=(16383&b)+((15&t)<<14),f.parts[1]=c,f.parts[2]=g,f.parts[3]=h,0===f.parts[0]&&0===f.parts[1]&&0===f.parts[2]&&0===f.parts[3])l=!0;else for(r=3;r>=0;r--){let e=0,t=function(e){let t=J.fromNumber(1e9),n=J.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:n};for(let r=0;r<=3;r++)n=(n=n.shiftLeft(32)).add(new J(e.parts[r],0)),e.parts[r]=n.div(t).low,n=n.modulo(t);return{quotient:e,rem:n}}(f);if(f=t.quotient,e=t.rem.low)for(n=8;n>=0;n--)o[9*r+n]=e%10,e=Math.floor(e/10)}if(l)i=1,o[s]=0;else for(i=36;!o[s];)i-=1,s+=1;let p=i-1+m;if(p>=34||p<=-7||m>0){if(i>34)return u.push("0"),m>0?u.push(`E+${m}`):m<0&&u.push(`E${m}`),u.join("");u.push(`${o[s++]}`),(i-=1)&&u.push(".");for(let e=0;e<i;e++)u.push(`${o[s++]}`);u.push("E"),p>0?u.push(`+${p}`):u.push(`${p}`)}else if(m>=0)for(let e=0;e<i;e++)u.push(`${o[s++]}`);else{let e=i+m;if(e>0)for(let t=0;t<e;t++)u.push(`${o[s++]}`);else u.push("0");for(u.push(".");e++<0;)u.push("0");for(let t=0;t<i-Math.max(e-1,0);t++)u.push(`${o[s++]}`)}return u.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(e){return W.fromString(e.$numberDecimal)}inspect(e,t,n){let r=(n??=g)(this.toString(),t);return`new Decimal128(${r})`}}class G extends _{get _bsontype(){return"Double"}constructor(e){super(),e instanceof Number&&(e=e.valueOf()),this.value=+e}static fromString(e){let t=Number(e);if("NaN"===e)return new G(NaN);if("Infinity"===e)return new G(1/0);if("-Infinity"===e)return new G(-1/0);if(!Number.isFinite(t))throw new d(`Input: ${e} is not representable as a Double`);if(e.trim()!==e)throw new d(`Input: '${e}' contains whitespace`);if(""===e)throw new d("Input is an empty string");if(/[^-0-9.+eE]/.test(e))throw new d(`Input: '${e}' is not in decimal or exponential notation`);return new G(t)}valueOf(){return this.value}toJSON(){return this.value}toString(e){return this.value.toString(e)}toExtendedJSON(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(e,t){let n=parseFloat(e.$numberDouble);return t&&t.relaxed?n:new G(n)}inspect(e,t,n){return n??=g,`new Double(${n(this.value,t)})`}}class X extends _{get _bsontype(){return"Int32"}constructor(e){super(),e instanceof Number&&(e=e.valueOf()),this.value=0|+e}static fromString(e){let t=D(e),n=Number(e);if(2147483647<n)throw new d(`Input: '${e}' is larger than the maximum value for Int32`);if(-2147483648>n)throw new d(`Input: '${e}' is smaller than the minimum value for Int32`);if(Number.isSafeInteger(n)){if(n.toString()!==t)throw new d(`Input: '${e}' is not a valid Int32 string`)}else throw new d(`Input: '${e}' is not a safe integer`);return new X(n)}valueOf(){return this.value}toString(e){return this.value.toString(e)}toJSON(){return this.value}toExtendedJSON(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(e,t){return t&&t.relaxed?parseInt(e.$numberInt,10):new X(e.$numberInt)}inspect(e,t,n){return n??=g,`new Int32(${n(this.value,t)})`}}class Q extends _{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new Q}inspect(){return"new MaxKey()"}}class ee extends _{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new ee}inspect(){return"new MinKey()"}}let et=new Float64Array(1),en=new Uint8Array(et.buffer,0,8);et[0]=-1;let er=0===en[7],ei={getNonnegativeInt32LE(e,t){if(e[t+3]>127)throw RangeError(`Size cannot be negative at offset: ${t}`);return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},getInt32LE:(e,t)=>e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,getUint32LE:(e,t)=>e[t]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3],getUint32BE:(e,t)=>e[t+3]+256*e[t+2]+65536*e[t+1]+16777216*e[t],getBigInt64LE(e,t){let n=ei.getUint32LE(e,t);return(BigInt(ei.getUint32LE(e,t+4))<<BigInt(32))+BigInt(n)},getFloat64LE:er?(e,t)=>(en[7]=e[t],en[6]=e[t+1],en[5]=e[t+2],en[4]=e[t+3],en[3]=e[t+4],en[2]=e[t+5],en[1]=e[t+6],en[0]=e[t+7],et[0]):(e,t)=>(en[0]=e[t],en[1]=e[t+1],en[2]=e[t+2],en[3]=e[t+3],en[4]=e[t+4],en[5]=e[t+5],en[6]=e[t+6],en[7]=e[t+7],et[0]),setInt32BE:(e,t,n)=>(e[t+3]=n,n>>>=8,e[t+2]=n,n>>>=8,e[t+1]=n,n>>>=8,e[t]=n,4),setInt32LE:(e,t,n)=>(e[t]=n,n>>>=8,e[t+1]=n,n>>>=8,e[t+2]=n,n>>>=8,e[t+3]=n,4),setBigInt64LE(e,t,n){let r=BigInt(4294967295),i=Number(n&r);e[t]=i,i>>=8,e[t+1]=i,i>>=8,e[t+2]=i,i>>=8,e[t+3]=i;let o=Number(n>>BigInt(32)&r);return e[t+4]=o,o>>=8,e[t+5]=o,o>>=8,e[t+6]=o,o>>=8,e[t+7]=o,8},setFloat64LE:er?(e,t,n)=>(et[0]=n,e[t]=en[7],e[t+1]=en[6],e[t+2]=en[5],e[t+3]=en[4],e[t+4]=en[3],e[t+5]=en[2],e[t+6]=en[1],e[t+7]=en[0],8):(e,t,n)=>(et[0]=n,e[t]=en[0],e[t+1]=en[1],e[t+2]=en[2],e[t+3]=en[3],e[t+4]=en[4],e[t+5]=en[5],e[t+6]=en[6],e[t+7]=en[7],8)},eo=RegExp("^[0-9a-fA-F]{24}$"),es=null;class el extends _{get _bsontype(){return"ObjectId"}constructor(e){let t;if(super(),"object"==typeof e&&e&&"id"in e){if("string"!=typeof e.id&&!ArrayBuffer.isView(e.id))throw new d("Argument passed in must have an id that is of type string or Buffer");t="toHexString"in e&&"function"==typeof e.toHexString?I.fromHex(e.toHexString()):e.id}else t=e;if(null==t||"number"==typeof t)this.buffer=el.generate("number"==typeof t?t:void 0);else if(ArrayBuffer.isView(t)&&12===t.byteLength)this.buffer=I.toLocalBufferType(t);else if("string"==typeof t){if(24===t.length&&eo.test(t))this.buffer=I.fromHex(t);else throw new d("input must be a 24 character hex string, 12 byte Uint8Array, or an integer")}else throw new d("Argument passed in does not match the accepted types");el.cacheHexString&&(this.__id=I.toHex(this.id))}get id(){return this.buffer}set id(e){this.buffer=e,el.cacheHexString&&(this.__id=I.toHex(e))}toHexString(){if(el.cacheHexString&&this.__id)return this.__id;let e=I.toHex(this.id);return el.cacheHexString&&!this.__id&&(this.__id=e),e}static getInc(){return el.index=(el.index+1)%16777215}static generate(e){"number"!=typeof e&&(e=Math.floor(Date.now()/1e3));let t=el.getInc(),n=I.allocateUnsafe(12);return ei.setInt32BE(n,0,e),null===es&&(es=I.randomBytes(5)),n[4]=es[0],n[5]=es[1],n[6]=es[2],n[7]=es[3],n[8]=es[4],n[11]=255&t,n[10]=t>>8&255,n[9]=t>>16&255,n}toString(e){return"base64"===e?I.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}static is(e){return null!=e&&"object"==typeof e&&"_bsontype"in e&&"ObjectId"===e._bsontype}equals(e){if(null==e)return!1;if(el.is(e))return this.buffer[11]===e.buffer[11]&&I.equals(this.buffer,e.buffer);if("string"==typeof e)return e.toLowerCase()===this.toHexString();if("object"==typeof e&&"function"==typeof e.toHexString){let t=e.toHexString(),n=this.toHexString();return"string"==typeof t&&t.toLowerCase()===n}return!1}getTimestamp(){let e=new Date,t=ei.getUint32BE(this.buffer,0);return e.setTime(1e3*Math.floor(t)),e}static createPk(){return new el}serializeInto(e,t){return e[t]=this.buffer[0],e[t+1]=this.buffer[1],e[t+2]=this.buffer[2],e[t+3]=this.buffer[3],e[t+4]=this.buffer[4],e[t+5]=this.buffer[5],e[t+6]=this.buffer[6],e[t+7]=this.buffer[7],e[t+8]=this.buffer[8],e[t+9]=this.buffer[9],e[t+10]=this.buffer[10],e[t+11]=this.buffer[11],12}static createFromTime(e){let t=I.allocate(12);for(let e=11;e>=4;e--)t[e]=0;return ei.setInt32BE(t,0,e),new el(t)}static createFromHexString(e){if(e?.length!==24)throw new d("hex string must be 24 characters");return new el(I.fromHex(e))}static createFromBase64(e){if(e?.length!==16)throw new d("base64 string must be 16 characters");return new el(I.fromBase64(e))}static isValid(e){if(null==e)return!1;try{return new el(e),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(e){return new el(e.$oid)}inspect(e,t,n){return n??=g,`new ObjectId(${n(this.toHexString(),t)})`}}function ef(e,t,n){let r=5;if(Array.isArray(e))for(let i=0;i<e.length;i++)r+=eu(i.toString(),e[i],t,!0,n);else for(let i of("function"==typeof e?.toBSON&&(e=e.toBSON()),Object.keys(e)))r+=eu(i,e[i],t,!1,n);return r}function eu(e,t,n=!1,r=!1,i=!1){switch("function"==typeof t?.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+I.utf8ByteLength(e)+1+4+I.utf8ByteLength(t)+1;case"number":if(Math.floor(t)!==t||!(t>=-9007199254740992)||!(t<=9007199254740992))return(null!=e?I.utf8ByteLength(e)+1:0)+9;if(t>=-2147483648&&t<=2147483647)return(null!=e?I.utf8ByteLength(e)+1:0)+5;return(null!=e?I.utf8ByteLength(e)+1:0)+9;case"undefined":if(r||!i)return(null!=e?I.utf8ByteLength(e)+1:0)+1;break;case"boolean":return(null!=e?I.utf8ByteLength(e)+1:0)+2;case"object":if(null!=t&&"string"==typeof t._bsontype&&6!==t[Symbol.for("@@mdb.bson.version")])throw new m;if(null==t||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?I.utf8ByteLength(e)+1:0)+1;if("ObjectId"===t._bsontype)return(null!=e?I.utf8ByteLength(e)+1:0)+13;if(t instanceof Date||h(t))return(null!=e?I.utf8ByteLength(e)+1:0)+9;else if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||l(t))return(null!=e?I.utf8ByteLength(e)+1:0)+6+t.byteLength;else if("Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?I.utf8ByteLength(e)+1:0)+9;else if("Decimal128"===t._bsontype)return(null!=e?I.utf8ByteLength(e)+1:0)+17;else if("Code"===t._bsontype){if(null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?I.utf8ByteLength(e)+1:0)+1+4+4+I.utf8ByteLength(t.code.toString())+1+ef(t.scope,n,i);return(null!=e?I.utf8ByteLength(e)+1:0)+1+4+I.utf8ByteLength(t.code.toString())+1}else if("Binary"===t._bsontype){let n=t;if(n.sub_type===L.SUBTYPE_BYTE_ARRAY)return(null!=e?I.utf8ByteLength(e)+1:0)+(n.position+1+4+1+4);return(null!=e?I.utf8ByteLength(e)+1:0)+(n.position+1+4+1)}else if("Symbol"===t._bsontype)return(null!=e?I.utf8ByteLength(e)+1:0)+I.utf8ByteLength(t.value)+4+1+1;else if("DBRef"===t._bsontype){let r=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return null!=t.db&&(r.$db=t.db),(null!=e?I.utf8ByteLength(e)+1:0)+1+ef(r,n,i)}else if(t instanceof RegExp||u(t))return(null!=e?I.utf8ByteLength(e)+1:0)+1+I.utf8ByteLength(t.source)+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;else if("BSONRegExp"===t._bsontype)return(null!=e?I.utf8ByteLength(e)+1:0)+1+I.utf8ByteLength(t.pattern)+1+I.utf8ByteLength(t.options)+1;else return(null!=e?I.utf8ByteLength(e)+1:0)+ef(t,n,i)+1;case"function":if(n)return(null!=e?I.utf8ByteLength(e)+1:0)+1+4+I.utf8ByteLength(t.toString())+1}return 0}el.index=Math.floor(16777215*Math.random());class ea extends _{get _bsontype(){return"BSONRegExp"}constructor(e,t){if(super(),this.pattern=e,this.options=(t??"").split("").sort().join(""),-1!==this.pattern.indexOf("\0"))throw new d(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(-1!==this.options.indexOf("\0"))throw new d(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let e=0;e<this.options.length;e++)if(!("i"===this.options[e]||"m"===this.options[e]||"x"===this.options[e]||"l"===this.options[e]||"s"===this.options[e]||"u"===this.options[e]))throw new d(`The regular expression option [${this.options[e]}] is not supported`)}static parseOptions(e){return e?e.split("").sort().join(""):""}toExtendedJSON(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(e){if("$regex"in e){if("string"==typeof e.$regex)return new ea(e.$regex,ea.parseOptions(e.$options));if("BSONRegExp"===e.$regex._bsontype)return e}if("$regularExpression"in e)return new ea(e.$regularExpression.pattern,ea.parseOptions(e.$regularExpression.options));throw new d(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(e)}`)}inspect(e,t,n){let r=function(e){if(null!=e&&"object"==typeof e&&"stylize"in e&&"function"==typeof e.stylize)return e.stylize}(t)??(e=>e),i=r((n??=g)(this.pattern),"regexp"),o=r(n(this.options),"regexp");return`new BSONRegExp(${i}, ${o})`}}class eh extends _{get _bsontype(){return"BSONSymbol"}constructor(e){super(),this.value=e}valueOf(){return this.value}toString(){return this.value}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(e){return new eh(e.$symbol)}inspect(e,t,n){return n??=g,`new BSONSymbol(${n(this.value,t)})`}}let eg=J;class ec extends eg{get _bsontype(){return"Timestamp"}constructor(e){if(null==e)super(0,0,!0);else if("bigint"==typeof e)super(e,!0);else if(J.isLong(e))super(e.low,e.high,!0);else if("object"==typeof e&&"t"in e&&"i"in e){if("number"!=typeof e.t&&("object"!=typeof e.t||"Int32"!==e.t._bsontype))throw new d("Timestamp constructed from { t, i } must provide t as a number");if("number"!=typeof e.i&&("object"!=typeof e.i||"Int32"!==e.i._bsontype))throw new d("Timestamp constructed from { t, i } must provide i as a number");let t=Number(e.t),n=Number(e.i);if(t<0||Number.isNaN(t))throw new d("Timestamp constructed from { t, i } must provide a positive t");if(n<0||Number.isNaN(n))throw new d("Timestamp constructed from { t, i } must provide a positive i");if(t>4294967295)throw new d("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(n>4294967295)throw new d("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(n,t,!0)}else throw new d("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}toJSON(){return{$timestamp:this.toString()}}static fromInt(e){return new ec(J.fromInt(e,!0))}static fromNumber(e){return new ec(J.fromNumber(e,!0))}static fromBits(e,t){return new ec({i:e,t:t})}static fromString(e,t){return new ec(J.fromString(e,!0,t))}toExtendedJSON(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}static fromExtendedJSON(e){let t=J.isLong(e.$timestamp.i)?e.$timestamp.i.getLowBitsUnsigned():e.$timestamp.i;return new ec({t:J.isLong(e.$timestamp.t)?e.$timestamp.t.getLowBitsUnsigned():e.$timestamp.t,i:t})}inspect(e,t,n){let r=(n??=g)(this.high>>>0,t),i=n(this.low>>>0,t);return`new Timestamp({ t: ${r}, i: ${i} })`}}ec.MAX_VALUE=J.MAX_UNSIGNED_VALUE;let eb=J.fromNumber(9007199254740992),ed=J.fromNumber(-9007199254740992);function em(e,t,n){let r=(t=null==t?{}:t)&&t.index?t.index:0,i=ei.getInt32LE(e,r);if(i<5)throw new d(`bson size must be >= 5, is ${i}`);if(t.allowObjectSmallerThanBufferSize&&e.length<i)throw new d(`buffer length ${e.length} must be >= bson size ${i}`);if(!t.allowObjectSmallerThanBufferSize&&e.length!==i)throw new d(`buffer length ${e.length} must === bson size ${i}`);if(i+r>e.byteLength)throw new d(`(bson size ${i} + options.index ${r} must be <= buffer length ${e.byteLength})`);if(0!==e[r+i-1])throw new d("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return function e(t,n,r,i=!1){let o,s;let l=null==r.fieldsAsRaw?null:r.fieldsAsRaw,f=null!=r.raw&&r.raw,u="boolean"==typeof r.bsonRegExp&&r.bsonRegExp,a=r.promoteBuffers??!1,h=r.promoteLongs??!0,g=r.promoteValues??!0,c=r.useBigInt64??!1;if(c&&!g||c&&!h)throw new d("Must either request bigint or Long for int64 deserialization");let b=null==r.validation?{utf8:!0}:r.validation,m=!0,p=b.utf8;if("boolean"==typeof p)o=p;else{m=!1;let e=Object.keys(p).map(function(e){return p[e]});if(0===e.length)throw new d("UTF-8 validation setting cannot be empty");if("boolean"!=typeof e[0])throw new d("Invalid UTF-8 validation option, must specify boolean values");if(o=e[0],!e.every(e=>e===o))throw new d("Invalid UTF-8 validation option - keys must be all true or all false")}if(!m)for(let e of(s=new Set,Object.keys(p)))s.add(e);let y=n;if(t.length<5)throw new d("corrupt bson message < 5 bytes long");let w=ei.getInt32LE(t,n);if(n+=4,w<5||w>t.length)throw new d("corrupt bson message");let S=i?[]:{},B=0,N=!i&&null;for(;;){let b;let p=t[n++];if(0===p)break;let y=n;for(;0!==t[y]&&y<t.length;)y++;if(y>=t.byteLength)throw new d("Bad BSON Document: illegal CString");let w=i?B++:I.toUTF8(t,n,y,!1),E=!0;if(E=m||s?.has(w)?o:!o,!1!==N&&"$"===w[0]&&(N=ep.test(w)),n=y+1,2===p){let e=ei.getInt32LE(t,n);if(n+=4,e<=0||e>t.length-n||0!==t[n+e-1])throw new d("bad string length in bson");b=I.toUTF8(t,n,n+e-1,E),n+=e}else if(7===p){let e=I.allocateUnsafe(12);for(let r=0;r<12;r++)e[r]=t[n+r];b=new el(e),n+=12}else if(16===p&&!1===g)b=new X(ei.getInt32LE(t,n)),n+=4;else if(16===p)b=ei.getInt32LE(t,n),n+=4;else if(1===p)b=ei.getFloat64LE(t,n),n+=8,!1===g&&(b=new G(b));else if(9===p){let e=ei.getInt32LE(t,n),r=ei.getInt32LE(t,n+4);n+=8,b=new Date(new J(e,r).toNumber())}else if(8===p){if(0!==t[n]&&1!==t[n])throw new d("illegal boolean type value");b=1===t[n++]}else if(3===p){let i=n,o=ei.getInt32LE(t,n);if(o<=0||o>t.length-n)throw new d("bad embedded document length in bson");if(f)b=t.slice(n,n+o);else{let n=r;m||(n={...r,validation:{utf8:E}}),b=e(t,i,n,!1)}n+=o}else if(4===p){let i=n,o=ei.getInt32LE(t,n),s=r,f=n+o;if(l&&l[w]&&(s={...r,raw:!0}),m||(s={...s,validation:{utf8:E}}),b=e(t,i,s,!0),0!==t[(n+=o)-1])throw new d("invalid array terminator byte");if(n!==f)throw new d("corrupted array bson")}else if(6===p)b=void 0;else if(10===p)b=null;else if(18===p){if(c)b=ei.getBigInt64LE(t,n),n+=8;else{let e=ei.getInt32LE(t,n),r=ei.getInt32LE(t,n+4);n+=8;let i=new J(e,r);b=h&&!0===g&&i.lessThanOrEqual(eb)&&i.greaterThanOrEqual(ed)?i.toNumber():i}}else if(19===p){let e=I.allocateUnsafe(16);for(let r=0;r<16;r++)e[r]=t[n+r];n+=16,b=new W(e)}else if(5===p){let e=ei.getInt32LE(t,n);n+=4;let r=e,i=t[n++];if(e<0)throw new d("Negative binary type element size found");if(e>t.byteLength)throw new d("Binary type size larger than document size");if(null!=t.slice){if(i===L.SUBTYPE_BYTE_ARRAY){if(e=ei.getInt32LE(t,n),n+=4,e<0)throw new d("Negative binary type element size found for subtype 0x02");if(e>r-4)throw new d("Binary type with subtype 0x02 contains too long binary size");if(e<r-4)throw new d("Binary type with subtype 0x02 contains too short binary size")}a&&g?b=I.toLocalBufferType(t.slice(n,n+e)):(b=new L(t.slice(n,n+e),i),4===i&&v.isValid(b)&&(b=b.toUUID()))}else{if(i===L.SUBTYPE_BYTE_ARRAY){if(e=ei.getInt32LE(t,n),n+=4,e<0)throw new d("Negative binary type element size found for subtype 0x02");if(e>r-4)throw new d("Binary type with subtype 0x02 contains too long binary size");if(e<r-4)throw new d("Binary type with subtype 0x02 contains too short binary size")}if(a&&g)for(y=0,b=I.allocateUnsafe(e);y<e;y++)b[y]=t[n+y];else b=new L(t.slice(n,n+e),i),4===i&&v.isValid(b)&&(b=b.toUUID())}n+=e}else if(11===p&&!1===u){for(y=n;0!==t[y]&&y<t.length;)y++;if(y>=t.length)throw new d("Bad BSON Document: illegal CString");let e=I.toUTF8(t,n,y,!1);for(y=n=y+1;0!==t[y]&&y<t.length;)y++;if(y>=t.length)throw new d("Bad BSON Document: illegal CString");let r=I.toUTF8(t,n,y,!1);n=y+1;let i=Array(r.length);for(y=0;y<r.length;y++)switch(r[y]){case"m":i[y]="m";break;case"s":i[y]="g";break;case"i":i[y]="i"}b=new RegExp(e,i.join(""))}else if(11===p&&!0===u){for(y=n;0!==t[y]&&y<t.length;)y++;if(y>=t.length)throw new d("Bad BSON Document: illegal CString");let e=I.toUTF8(t,n,y,!1);for(y=n=y+1;0!==t[y]&&y<t.length;)y++;if(y>=t.length)throw new d("Bad BSON Document: illegal CString");let r=I.toUTF8(t,n,y,!1);n=y+1,b=new ea(e,r)}else if(14===p){let e=ei.getInt32LE(t,n);if(n+=4,e<=0||e>t.length-n||0!==t[n+e-1])throw new d("bad string length in bson");let r=I.toUTF8(t,n,n+e-1,E);b=g?r:new eh(r),n+=e}else if(17===p)b=new ec({i:ei.getUint32LE(t,n),t:ei.getUint32LE(t,n+4)}),n+=8;else if(255===p)b=new ee;else if(127===p)b=new Q;else if(13===p){let e=ei.getInt32LE(t,n);if(n+=4,e<=0||e>t.length-n||0!==t[n+e-1])throw new d("bad string length in bson");b=new j(I.toUTF8(t,n,n+e-1,E)),n+=e}else if(15===p){let i=ei.getInt32LE(t,n);if(n+=4,i<13)throw new d("code_w_scope total size shorter minimum expected length");let o=ei.getInt32LE(t,n);if(n+=4,o<=0||o>t.length-n||0!==t[n+o-1])throw new d("bad string length in bson");let s=I.toUTF8(t,n,n+o-1,E),l=n+=o,f=ei.getInt32LE(t,n),u=e(t,l,r,!1);if(n+=f,i<8+f+o)throw new d("code_w_scope total size is too short, truncating scope");if(i>8+f+o)throw new d("code_w_scope total size is too long, clips outer document");b=new j(s,u)}else if(12===p){let e=ei.getInt32LE(t,n);if(n+=4,e<=0||e>t.length-n||0!==t[n+e-1])throw new d("bad string length in bson");let r=I.toUTF8(t,n,n+e-1,E);n+=e;let i=I.allocateUnsafe(12);for(let e=0;e<12;e++)i[e]=t[n+e];n+=12,b=new R(r,new el(i))}else throw new d(`Detected unknown BSON type ${p.toString(16)} for fieldname "${w}"`);"__proto__"===w?Object.defineProperty(S,w,{value:b,writable:!0,enumerable:!0,configurable:!0}):S[w]=b}if(w!==n-y){if(i)throw new d("corrupt array bson");throw new d("corrupt object bson")}if(!N)return S;if(A(S)){let e=Object.assign({},S);return delete e.$ref,delete e.$id,delete e.$db,new R(S.$ref,S.$id,S.$db,e)}return S}(e,r,t,n)}let ep=/^\$ref$|^\$id$|^\$db$/,ey=/\x00/,ew=new Set(["$db","$ref","$id","$clusterTime"]);function eS(e,t,n,r){e[r++]=2;let i=I.encodeUTF8Into(e,t,r);e[(r=r+i+1)-1]=0;let o=I.encodeUTF8Into(e,n,r+4);return ei.setInt32LE(e,r,o+1),r=r+4+o,e[r++]=0,r}function eB(e,t,n,r){let i=!Object.is(n,-0)&&Number.isSafeInteger(n)&&n<=2147483647&&n>=-2147483648?16:1;e[r++]=i;let o=I.encodeUTF8Into(e,t,r);return r+=o,e[r++]=0,16===i?r+=ei.setInt32LE(e,r,n):r+=ei.setFloat64LE(e,r,n),r}function eN(e,t,n,r){e[r++]=18;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r+=ei.setBigInt64LE(e,r,n)}function eE(e,t,n,r){e[r++]=10;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r}function eO(e,t,n,r){e[r++]=8;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,e[r++]=n?1:0,r}function ex(e,t,n,r){e[r++]=9;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=J.fromNumber(n.getTime()),s=o.getLowBits(),l=o.getHighBits();return r+=ei.setInt32LE(e,r,s),r+=ei.setInt32LE(e,r,l)}function e$(e,t,n,r){e[r++]=11;let i=I.encodeUTF8Into(e,t,r);if(r+=i,e[r++]=0,n.source&&null!=n.source.match(ey))throw new d("value "+n.source+" must not contain null bytes");return r+=I.encodeUTF8Into(e,n.source,r),e[r++]=0,n.ignoreCase&&(e[r++]=105),n.global&&(e[r++]=115),n.multiline&&(e[r++]=109),e[r++]=0,r}function eI(e,t,n,r){e[r++]=11;let i=I.encodeUTF8Into(e,t,r);if(r+=i,e[r++]=0,null!=n.pattern.match(ey))throw new d("pattern "+n.pattern+" must not contain null bytes");r+=I.encodeUTF8Into(e,n.pattern,r),e[r++]=0;let o=n.options.split("").sort().join("");return r+=I.encodeUTF8Into(e,o,r),e[r++]=0,r}function e_(e,t,n,r){null===n?e[r++]=10:"MinKey"===n._bsontype?e[r++]=255:e[r++]=127;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r}function eL(e,t,n,r){e[r++]=7;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r+=n.serializeInto(e,r)}function eU(e,t,n,r){e[r++]=5;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.length;if(r+=ei.setInt32LE(e,r,o),e[r++]=0,o<=16)for(let t=0;t<o;t++)e[r+t]=n[t];else e.set(n,r);return r+o}function eT(e,t,n,r,i,o,s,l,f){if(f.has(n))throw new d("Cannot convert circular structure to BSON");f.add(n),e[r++]=Array.isArray(n)?4:3;let u=I.encodeUTF8Into(e,t,r);r+=u,e[r++]=0;let a=eV(e,n,i,r,o+1,s,l,f);return f.delete(n),a}function ev(e,t,n,r){e[r++]=19;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;for(let t=0;t<16;t++)e[r+t]=n.bytes[t];return r+16}function ej(e,t,n,r){e[r++]="Long"===n._bsontype?18:17;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.getLowBits(),s=n.getHighBits();return r+=ei.setInt32LE(e,r,o),r+=ei.setInt32LE(e,r,s)}function eA(e,t,n,r){n=n.valueOf(),e[r++]=16;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r+=ei.setInt32LE(e,r,n)}function eR(e,t,n,r){e[r++]=1;let i=I.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r+=ei.setFloat64LE(e,r,n.value)}function eD(e,t,n,r){e[r++]=13;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.toString(),s=I.encodeUTF8Into(e,o,r+4)+1;return ei.setInt32LE(e,r,s),r=r+4+s-1,e[r++]=0,r}function eF(e,t,n,r,i=!1,o=0,s=!1,l=!0,f){if(n.scope&&"object"==typeof n.scope){e[r++]=15;let u=I.encodeUTF8Into(e,t,r);r+=u,e[r++]=0;let a=r,h=n.code;r+=4;let g=I.encodeUTF8Into(e,h,r+4)+1;ei.setInt32LE(e,r,g),e[r+4+g-1]=0,r=r+g+4;let c=eV(e,n.scope,i,r,o+1,s,l,f);r=c-1;let b=c-a;a+=ei.setInt32LE(e,a,b),e[r++]=0}else{e[r++]=13;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.code.toString(),s=I.encodeUTF8Into(e,o,r+4)+1;ei.setInt32LE(e,r,s),r=r+4+s-1,e[r++]=0}return r}function ez(e,t,n,r){e[r++]=5;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.buffer,s=n.position;if(n.sub_type===L.SUBTYPE_BYTE_ARRAY&&(s+=4),r+=ei.setInt32LE(e,r,s),e[r++]=n.sub_type,n.sub_type===L.SUBTYPE_BYTE_ARRAY&&(s-=4,r+=ei.setInt32LE(e,r,s)),s<=16)for(let t=0;t<s;t++)e[r+t]=o[t];else e.set(o,r);return r+n.position}function eM(e,t,n,r){e[r++]=14;let i=I.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=I.encodeUTF8Into(e,n.value,r+4)+1;return ei.setInt32LE(e,r,o),r=r+4+o-1,e[r++]=0,r}function eJ(e,t,n,r,i,o,s){e[r++]=3;let l=I.encodeUTF8Into(e,t,r);r+=l,e[r++]=0;let f=r,u={$ref:n.collection||n.namespace,$id:n.oid};null!=n.db&&(u.$db=n.db);let a=eV(e,u=Object.assign(u,n.fields),!1,r,i+1,o,!0,s),h=a-f;return f+=ei.setInt32LE(e,r,h),a}function eV(e,t,n,r,i,o,s,g){if(null==g){if(null==t)return e[0]=5,e[1]=0,e[2]=0,e[3]=0,e[4]=0,5;if(Array.isArray(t))throw new d("serialize does not support an array as the root input");if("object"!=typeof t)throw new d("serialize does not support non-object as the root input");if("_bsontype"in t&&"string"==typeof t._bsontype)throw new d("BSON types cannot be serialized as a document");if(h(t)||u(t)||f(t)||l(t))throw new d("date, regexp, typedarray, and arraybuffer cannot be BSON documents");g=new Set}g.add(t);let c=r+4;if(Array.isArray(t))for(let r=0;r<t.length;r++){let l=`${r}`,a=t[r];if("function"==typeof a?.toBSON&&(a=a.toBSON()),"string"==typeof a)c=eS(e,l,a,c);else if("number"==typeof a)c=eB(e,l,a,c);else if("bigint"==typeof a)c=eN(e,l,a,c);else if("boolean"==typeof a)c=eO(e,l,a,c);else if(a instanceof Date||h(a))c=ex(e,l,a,c);else if(void 0===a)c=eE(e,l,a,c);else if(null===a)c=eE(e,l,a,c);else if(f(a))c=eU(e,l,a,c);else if(a instanceof RegExp||u(a))c=e$(e,l,a,c);else if("object"==typeof a&&null==a._bsontype)c=eT(e,l,a,c,n,i,o,s,g);else if("object"==typeof a&&6!==a[Symbol.for("@@mdb.bson.version")])throw new m;else if("ObjectId"===a._bsontype)c=eL(e,l,a,c);else if("Decimal128"===a._bsontype)c=ev(e,l,a,c);else if("Long"===a._bsontype||"Timestamp"===a._bsontype)c=ej(e,l,a,c);else if("Double"===a._bsontype)c=eR(e,l,a,c);else if("function"==typeof a&&o)c=eD(e,l,a,c);else if("Code"===a._bsontype)c=eF(e,l,a,c,n,i,o,s,g);else if("Binary"===a._bsontype)c=ez(e,l,a,c);else if("BSONSymbol"===a._bsontype)c=eM(e,l,a,c);else if("DBRef"===a._bsontype)c=eJ(e,l,a,c,i,o,g);else if("BSONRegExp"===a._bsontype)c=eI(e,l,a,c);else if("Int32"===a._bsontype)c=eA(e,l,a,c);else if("MinKey"===a._bsontype||"MaxKey"===a._bsontype)c=e_(e,l,a,c);else if(void 0!==a._bsontype)throw new d(`Unrecognized or invalid _bsontype: ${String(a._bsontype)}`)}else if(t instanceof Map||a(t)){let r=t.entries(),l=!1;for(;!l;){let t=r.next();if(l=!!t.done)continue;let a=t.value[0],b=t.value[1];"function"==typeof b?.toBSON&&(b=b.toBSON());let p=typeof b;if("string"==typeof a&&!ew.has(a)){if(null!=a.match(ey))throw new d("key "+a+" must not contain null bytes");if(n){if("$"===a[0])throw new d("key "+a+" must not start with '$'");if(a.includes("."))throw new d("key "+a+" must not contain '.'")}}if("string"===p)c=eS(e,a,b,c);else if("number"===p)c=eB(e,a,b,c);else if("bigint"===p)c=eN(e,a,b,c);else if("boolean"===p)c=eO(e,a,b,c);else if(b instanceof Date||h(b))c=ex(e,a,b,c);else if(null===b||void 0===b&&!1===s)c=eE(e,a,b,c);else if(f(b))c=eU(e,a,b,c);else if(b instanceof RegExp||u(b))c=e$(e,a,b,c);else if("object"===p&&null==b._bsontype)c=eT(e,a,b,c,n,i,o,s,g);else if("object"==typeof b&&6!==b[Symbol.for("@@mdb.bson.version")])throw new m;else if("ObjectId"===b._bsontype)c=eL(e,a,b,c);else if("object"===p&&"Decimal128"===b._bsontype)c=ev(e,a,b,c);else if("Long"===b._bsontype||"Timestamp"===b._bsontype)c=ej(e,a,b,c);else if("Double"===b._bsontype)c=eR(e,a,b,c);else if("Code"===b._bsontype)c=eF(e,a,b,c,n,i,o,s,g);else if("function"==typeof b&&o)c=eD(e,a,b,c);else if("Binary"===b._bsontype)c=ez(e,a,b,c);else if("BSONSymbol"===b._bsontype)c=eM(e,a,b,c);else if("DBRef"===b._bsontype)c=eJ(e,a,b,c,i,o,g);else if("BSONRegExp"===b._bsontype)c=eI(e,a,b,c);else if("Int32"===b._bsontype)c=eA(e,a,b,c);else if("MinKey"===b._bsontype||"MaxKey"===b._bsontype)c=e_(e,a,b,c);else if(void 0!==b._bsontype)throw new d(`Unrecognized or invalid _bsontype: ${String(b._bsontype)}`)}}else{if("function"==typeof t?.toBSON&&null!=(t=t.toBSON())&&"object"!=typeof t)throw new d("toBSON function did not return an object");for(let r of Object.keys(t)){let l=t[r];"function"==typeof l?.toBSON&&(l=l.toBSON());let a=typeof l;if("string"==typeof r&&!ew.has(r)){if(null!=r.match(ey))throw new d("key "+r+" must not contain null bytes");if(n){if("$"===r[0])throw new d("key "+r+" must not start with '$'");if(r.includes("."))throw new d("key "+r+" must not contain '.'")}}if("string"===a)c=eS(e,r,l,c);else if("number"===a)c=eB(e,r,l,c);else if("bigint"===a)c=eN(e,r,l,c);else if("boolean"===a)c=eO(e,r,l,c);else if(l instanceof Date||h(l))c=ex(e,r,l,c);else if(void 0===l)!1===s&&(c=eE(e,r,l,c));else if(null===l)c=eE(e,r,l,c);else if(f(l))c=eU(e,r,l,c);else if(l instanceof RegExp||u(l))c=e$(e,r,l,c);else if("object"===a&&null==l._bsontype)c=eT(e,r,l,c,n,i,o,s,g);else if("object"==typeof l&&6!==l[Symbol.for("@@mdb.bson.version")])throw new m;else if("ObjectId"===l._bsontype)c=eL(e,r,l,c);else if("object"===a&&"Decimal128"===l._bsontype)c=ev(e,r,l,c);else if("Long"===l._bsontype||"Timestamp"===l._bsontype)c=ej(e,r,l,c);else if("Double"===l._bsontype)c=eR(e,r,l,c);else if("Code"===l._bsontype)c=eF(e,r,l,c,n,i,o,s,g);else if("function"==typeof l&&o)c=eD(e,r,l,c);else if("Binary"===l._bsontype)c=ez(e,r,l,c);else if("BSONSymbol"===l._bsontype)c=eM(e,r,l,c);else if("DBRef"===l._bsontype)c=eJ(e,r,l,c,i,o,g);else if("BSONRegExp"===l._bsontype)c=eI(e,r,l,c);else if("Int32"===l._bsontype)c=eA(e,r,l,c);else if("MinKey"===l._bsontype||"MaxKey"===l._bsontype)c=e_(e,r,l,c);else if(void 0!==l._bsontype)throw new d(`Unrecognized or invalid _bsontype: ${String(l._bsontype)}`)}}g.delete(t),e[c++]=0;let b=c-r;return r+=ei.setInt32LE(e,r,b),c}let eC={$oid:el,$binary:L,$uuid:L,$symbol:eh,$numberInt:X,$numberDecimal:W,$numberDouble:G,$numberLong:J,$minKey:ee,$maxKey:Q,$regex:ea,$regularExpression:ea,$timestamp:ec};function eH(e){let t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}let ek={Binary:e=>new L(e.value(),e.sub_type),Code:e=>new j(e.code,e.scope),DBRef:e=>new R(e.collection||e.namespace,e.oid,e.db,e.fields),Decimal128:e=>new W(e.bytes),Double:e=>new G(e.value),Int32:e=>new X(e.value),Long:e=>J.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_),MaxKey:()=>new Q,MinKey:()=>new ee,ObjectId:e=>new el(e),BSONRegExp:e=>new ea(e.pattern,e.options),BSONSymbol:e=>new eh(e.value),Timestamp:e=>ec.fromBits(e.low,e.high)};function eq(e,t){let n={useBigInt64:t?.useBigInt64??!1,relaxed:t?.relaxed??!0,legacy:t?.legacy??!1};return JSON.parse(e,(e,t)=>{if(-1!==e.indexOf("\0"))throw new d(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(e)}`);return function e(t,n={}){if("number"==typeof t){let e=t<=2147483647&&t>=-2147483648,r=t<=c&&t>=-0x8000000000000000;if(n.relaxed||n.legacy)return t;if(Number.isInteger(t)&&!Object.is(t,-0)){if(e)return new X(t);if(r)return n.useBigInt64?BigInt(t):J.fromNumber(t)}return new G(t)}if(null==t||"object"!=typeof t)return t;if(t.$undefined)return null;let r=Object.keys(t).filter(e=>e.startsWith("$")&&null!=t[e]);for(let e=0;e<r.length;e++){let i=eC[r[e]];if(i)return i.fromExtendedJSON(t,n)}if(null!=t.$date){let e=t.$date,r=new Date;if(n.legacy){if("number"==typeof e)r.setTime(e);else if("string"==typeof e)r.setTime(Date.parse(e));else if("bigint"==typeof e)r.setTime(Number(e));else throw new p(`Unrecognized type for EJSON date: ${typeof e}`)}else if("string"==typeof e)r.setTime(Date.parse(e));else if(J.isLong(e))r.setTime(e.toNumber());else if("number"==typeof e&&n.relaxed)r.setTime(e);else if("bigint"==typeof e)r.setTime(Number(e));else throw new p(`Unrecognized type for EJSON date: ${typeof e}`);return r}if(null!=t.$code){let n=Object.assign({},t);return t.$scope&&(n.$scope=e(t.$scope)),j.fromExtendedJSON(t)}if(A(t)||t.$dbPointer){let e=t.$ref?t:t.$dbPointer;if(e instanceof R)return e;let n=Object.keys(e).filter(e=>e.startsWith("$")),r=!0;if(n.forEach(e=>{-1===["$ref","$id","$db"].indexOf(e)&&(r=!1)}),r)return R.fromExtendedJSON(e)}return t}(t,n)})}function eY(e,t,n,r){return null!=n&&"object"==typeof n&&(r=n,n=0),null==t||"object"!=typeof t||Array.isArray(t)||(r=t,t=void 0,n=0),JSON.stringify(function e(t,n){if(t instanceof Map||a(t)){let r=Object.create(null);for(let[e,n]of t){if("string"!=typeof e)throw new d("Can only serialize maps with string keys");r[e]=n}return e(r,n)}if(("object"==typeof t||"function"==typeof t)&&null!==t){let e=n.seenObjects.findIndex(e=>e.obj===t);if(-1!==e){let t=n.seenObjects.map(e=>e.propertyName),r=t.slice(0,e).map(e=>`${e} -> `).join(""),i=t[e],o=" -> "+t.slice(e+1,t.length-1).map(e=>`${e} -> `).join(""),s=t[t.length-1],l=" ".repeat(r.length+i.length/2),f="-".repeat(o.length+(i.length+s.length)/2-1);throw new d(`Converting circular structure to EJSON:
    ${r}${i}${o}${s}
    ${l}\\${f}/`)}n.seenObjects[n.seenObjects.length-1].obj=t}if(Array.isArray(t))return t.map((t,r)=>{n.seenObjects.push({propertyName:`index ${r}`,obj:null});try{return e(t,n)}finally{n.seenObjects.pop()}});if(void 0===t)return null;if(t instanceof Date||h(t)){let e=t.getTime(),r=e>-1&&e<2534023188e5;return n.legacy?n.relaxed&&r?{$date:t.getTime()}:{$date:eH(t)}:n.relaxed&&r?{$date:eH(t)}:{$date:{$numberLong:t.getTime().toString()}}}if("number"==typeof t&&(!n.relaxed||!isFinite(t))){if(Number.isInteger(t)&&!Object.is(t,-0)){if(t>=-2147483648&&t<=2147483647)return{$numberInt:t.toString()};if(t>=-0x8000000000000000&&t<=c)return{$numberLong:t.toString()}}return{$numberDouble:Object.is(t,-0)?"-0.0":t.toString()}}if("bigint"==typeof t)return n.relaxed?Number(BigInt.asIntN(64,t)):{$numberLong:BigInt.asIntN(64,t).toString()};if(t instanceof RegExp||u(t)){let e=t.flags;if(void 0===e){let n=t.toString().match(/[gimuy]*$/);n&&(e=n[0])}return new ea(t.source,e).toExtendedJSON(n)}return null!=t&&"object"==typeof t?function(t,n){if(null==t||"object"!=typeof t)throw new d("not an object instance");let r=t._bsontype;if(void 0===r){let r={};for(let i of Object.keys(t)){n.seenObjects.push({propertyName:i,obj:null});try{let o=e(t[i],n);"__proto__"===i?Object.defineProperty(r,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):r[i]=o}finally{n.seenObjects.pop()}}return r}if(null!=t&&"object"==typeof t&&"string"==typeof t._bsontype&&6!==t[Symbol.for("@@mdb.bson.version")])throw new m;if(null!=t&&"object"==typeof t&&"_bsontype"in t&&"string"==typeof t._bsontype){let i=t;if("function"!=typeof i.toExtendedJSON){let e=ek[t._bsontype];if(!e)throw new d("Unrecognized or invalid _bsontype: "+t._bsontype);i=e(i)}return"Code"===r&&i.scope?i=new j(i.code,e(i.scope,n)):"DBRef"===r&&i.oid&&(i=new R(e(i.collection,n),e(i.oid,n),e(i.db,n),e(i.fields,n))),i.toExtendedJSON(n)}throw new d("_bsontype must be a string, but was: "+typeof r)}(t,n):t}(e,Object.assign({relaxed:!0,legacy:!1},r,{seenObjects:[{propertyName:"(root)",obj:null}]})),t,n)}let eZ=Object.create(null);function eP(e,t){try{return ei.getNonnegativeInt32LE(e,t)}catch(e){throw new y("BSON size cannot be negative",t,{cause:e})}}function eK(e,t){let n=t;for(;0!==e[n];n++);if(n===e.length-1)throw new y("Null terminator not found",t);return n}eZ.parse=eq,eZ.stringify=eY,eZ.serialize=function(e,t){return JSON.parse(eY(e,t=t||{}))},eZ.deserialize=function(e,t){return t=t||{},eq(JSON.stringify(e),t)},Object.freeze(eZ);let eW=Object.create(null);eW.parseToElements=function(e,t=0){if(t??=0,e.length<5)throw new y(`Input must be at least 5 bytes, got ${e.length} bytes`,t);let n=eP(e,t);if(n>e.length-t)throw new y(`Parsed documentSize (${n} bytes) does not match input length (${e.length} bytes)`,t);if(0!==e[t+n-1])throw new y("BSON documents must end in 0x00",t+n);let r=[],i=t+4;for(;i<=n+t;){let o;let s=e[i];if(i+=1,0===s){if(i-t!==n)throw new y("Invalid 0x00 type byte",i);break}let l=i,f=eK(e,i)-l;if(i+=f+1,1===s||18===s||9===s||17===s)o=8;else if(16===s)o=4;else if(7===s)o=12;else if(19===s)o=16;else if(8===s)o=1;else if(10===s||6===s||127===s||255===s)o=0;else if(11===s)o=eK(e,eK(e,i)+1)+1-i;else if(3===s||4===s||15===s)o=eP(e,i);else if(2===s||5===s||12===s||13===s||14===s)o=eP(e,i)+4,5===s&&(o+=1),12===s&&(o+=12);else throw new y(`Invalid 0x${s.toString(16).padStart(2,"0")} type byte`,i);if(o>n)throw new y("value reports length larger than document",i);r.push([s,l,f,i,o]),i+=o}return r},eW.ByteUtils=I,eW.NumberUtils=ei,Object.freeze(eW);let eG=I.allocate(17825792);function eX(e){eG.length<e&&(eG=I.allocate(e))}function eQ(e,t={}){let n="boolean"==typeof t.checkKeys&&t.checkKeys,r="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,i="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,o="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;eG.length<o&&(eG=I.allocate(o));let s=eV(eG,e,n,0,0,r,i,null),l=I.allocateUnsafe(s);return l.set(eG.subarray(0,s),0),l}function e1(e,t,n={}){let r="boolean"==typeof n.checkKeys&&n.checkKeys,i="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,o="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0,l=eV(eG,e,r,0,0,i,o,null);return t.set(eG.subarray(0,l),s),s+l-1}function e0(e,t={}){return em(I.toLocalBufferType(e),t)}function e2(e,t={}){return ef(e,"boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,"boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined)}function e3(e,t,n,r,i,o){let s=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},o),l=I.toLocalBufferType(e),f=t;for(let e=0;e<n;e++){let t=ei.getInt32LE(l,f);s.index=f,r[i+e]=em(l,s),f+=t}return f}var e6=Object.freeze({__proto__:null,BSONError:d,BSONOffsetError:y,BSONRegExp:ea,BSONRuntimeError:p,BSONSymbol:eh,BSONType:b,BSONValue:_,BSONVersionError:m,Binary:L,Code:j,DBRef:R,Decimal128:W,Double:G,EJSON:eZ,Int32:X,Long:J,MaxKey:Q,MinKey:ee,ObjectId:el,Timestamp:ec,UUID:v,calculateObjectSize:e2,deserialize:e0,deserializeStream:e3,onDemand:eW,serialize:eQ,serializeWithBufferAndIndex:e1,setInternalBufferSize:eX});t.BSON=e6,t.BSONError=d,t.BSONOffsetError=y,t.BSONRegExp=ea,t.BSONRuntimeError=p,t.BSONSymbol=eh,t.BSONType=b,t.BSONValue=_,t.BSONVersionError=m,t.Binary=L,t.Code=j,t.DBRef=R,t.Decimal128=W,t.Double=G,t.EJSON=eZ,t.Int32=X,t.Long=J,t.MaxKey=Q,t.MinKey=ee,t.ObjectId=el,t.Timestamp=ec,t.UUID=v,t.calculateObjectSize=e2,t.deserialize=e0,t.deserializeStream=e3,t.onDemand=eW,t.serialize=eQ,t.serializeWithBufferAndIndex=e1,t.setInternalBufferSize=eX}}]);